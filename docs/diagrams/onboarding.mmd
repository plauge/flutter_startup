flowchart TD
    Desc["ğŸ“‹ Onboarding og Terms of Service\nNogle sider (Kontakter, Home, Connect osv.) krÃ¦ver at brugeren\nhar gennemfÃ¸rt onboarding. Hvis ikke, sendes de til start.\nTerms-flowet viser hvad der sker nÃ¥r bruger accepterer:\nsecurity key oprettes, gemmes lokalt og i skyen."]
    style Desc fill:#e8f4fd,stroke:#b8d4e8

    subgraph Pages ["Hvilke sider krÃ¦ver fÃ¦rdigt onboarding?"]
        PagesList["Kontakter, Kontaktverifikation,\nConnect, QR-kode flows,\nHome"]
    end

    subgraph Check ["Tjek nÃ¥r bruger Ã¥bner en af disse sider"]
        IsPage["Er det en af siderne\nder krÃ¦ver onboarding?"]
        WatchUserExtra["Hent brugerens profil\nfra Supabase"]
        CheckOnboarding["Har brugeren gennemfÃ¸rt\nhele onboarding-flowet?\n(userExtra.onboarding)"]
        IsPage -->|"Ja"| WatchUserExtra
        WatchUserExtra --> CheckOnboarding
        CheckOnboarding -->|"Nej â€” mangler stadig"| GoOnboarding["Send til\nonboarding-start"]
        CheckOnboarding -->|"Ja â€” fÃ¦rdiggjort"| ShowScreen["Vis den Ã¸nskede side"]
    end

    subgraph Terms ["Terms of Service â€” ved accept"]
        TermsAgree["Bruger lÃ¦ser og\naccepterer betingelser"]
        TermsAgree --> GenToken["Opret security key:\nGenerer token, gem lokalt\n+ krypteret check-vÃ¦rdi i skyen"]
        GenToken --> UpdateUserExtra["Opdater user_extra i Supabase\nmed encryptedMasterkeyCheckValue"]
        UpdateUserExtra --> NavHome["Send bruger til start"]
    end
