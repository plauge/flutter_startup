flowchart TD
    Desc["ğŸ”’ Security check for PIN-beskyttede sider\nBrugerens security key gemmes KUN pÃ¥ telefonen â€” aldrig i skyen.\nFor at verificere key'en krypterer vi en kendt tekst ved oprettelse\nog gemmer den krypterede version i skyen. Ved adgang dekrypterer\nvi med telefonens key â€” matcher resultatet, er key'en korrekt."]
    style Desc fill:#e8f4fd,stroke:#b8d4e8

    Start["Bruger Ã¥bner en\nPIN-beskyttet side"] --> Guard{"KrÃ¦ver siden\nsecurity key check?"}
    Guard -->|"Nej â€” ikke PIN-beskyttet\neller allerede pÃ¥ key-opsÃ¦tning"| Skip["Vis sidens indhold"]
    Guard -->|"Ja"| Step1

    Step1["1. Har brugeren oprettet\nen security key?\nTjek: findes der en krypteret\ncheck-vÃ¦rdi i skyen"] --> Q1{"Findes?"}
    Q1 -->|"Nej â€” aldrig oprettet"| Denied

    Q1 -->|"Ja"| Step2["2. Er brugeren logget ind?"]
    Step2 --> Q2{"Gyldig session?"}
    Q2 -->|"Nej"| Denied

    Q2 -->|"Ja"| Step3["3. Ligger security key'en\npÃ¥ denne telefon?\nKey gemmes kun lokalt og\nfÃ¸lger ikke med til nye enheder"]
    Step3 --> Q3{"Key fundet?"}
    Q3 -->|"Nej â€” fx ny telefon\neller app geninstalleret"| Denied

    Q3 -->|"Ja"| Step4["4. Er key'en den rigtige?\nDekryptÃ©r check-vÃ¦rdien fra skyen\nmed telefonens lokale key"]
    Step4 --> Q4{"Matcher resultatet\nden kendte tekst?"}
    Q4 -->|"Ja"| Granted["âœ… Adgang tilladt\nVis sidens indhold"]
    Q4 -->|"Nej â€” forkert key\neller korrupt data"| Denied

    Denied["ğŸš« Adgang nÃ¦gtet\nBruger sendes til side hvor\nsecurity key kan oprettes\neller gendannes"]
